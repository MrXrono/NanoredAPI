# NanoredVPN API Configuration
SECRET_KEY=change-me-to-random-string-at-least-32-chars
ADMIN_USERNAME=admin
ADMIN_PASSWORD=your-secure-password-here
TELEGRAM_MESSAGE_BOT_TOKEN=
# Support forum/supergroup id where topics are created (must be -100...)
TELEGRAM_SUPPORT_GROUP_ID=

# Local state file for Telegram support forum bot (like nanored_support_bot data.json).
# Recommended: keep it on a host-mounted volume. docker-compose mounts ./data -> /app/data.
TELEGRAM_SUPPORT_DATA_FILE=/app/data/data.json

# External URL of this API (publicly reachable). Used to derive Telegram webhook URL automatically.
# Example: https://api.nanored.top
PUBLIC_BASE_URL=

# Optional: auto-configure Telegram webhook on startup (must be publicly reachable by Telegram).
# If empty, it will be derived as: ${PUBLIC_BASE_URL}/api/v1/client/support/telegram/webhook
TELEGRAM_WEBHOOK_URL=

# Optional: enable secret_token header verification for Telegram webhook.
# If set, NanoredAPI expects header: X-Telegram-Bot-Api-Secret-Token: <TELEGRAM_WEBHOOK_SECRET>
TELEGRAM_WEBHOOK_SECRET=

# Optional: drop pending updates when setting webhook (useful after downtime; resets Telegram backlog).
TELEGRAM_WEBHOOK_DROP_PENDING_UPDATES=0

# Shared token for rsyslog -> /api/v1/client/remnawave/ingest
REMNAWAVE_LOG_INGEST_TOKEN=change-me-random-long-token

# Low-resource tuning (1 vCPU / 2GB RAM profile)
DB_POOL_SIZE=3
DB_MAX_OVERFLOW=1
DB_POOL_TIMEOUT_SECONDS=30
DB_POOL_RECYCLE_SECONDS=1800
DB_POOL_PRE_PING=1
DB_COMMAND_TIMEOUT_SECONDS=60
DB_STATEMENT_TIMEOUT_MS=30000
DB_LOCK_TIMEOUT_MS=5000
DB_IDLE_IN_TX_TIMEOUT_MS=60000
DB_JIT_ENABLED=0
DB_WORK_MEM_MB=16
DB_MAINTENANCE_ENABLED=1
DB_MAINTENANCE_ANALYZE_INTERVAL_SECONDS=1800
DB_MAINTENANCE_INDEX_SETUP_ON_STARTUP=1
REDIS_MAX_CONNECTIONS=20
LOG_BUFFER_MAXLEN=1000
REQUEST_LOG_MAX_BODY_BYTES=4096
BG_SESSION_CLEANUP_INTERVAL_SECONDS=300
BG_SESSION_CLEANUP_BATCH_SIZE=1000
ADULT_RECHECK_BATCH_LIMIT=1000
ADULT_RECHECK_MAX_BATCHES_PER_LOOP=2
ADULT_RECHECK_LOOP_SLEEP_SECONDS=30
ADULT_SYNC_TXT_DB_CHUNK_SIZE=5000
ADULT_SYNC_TXT_DB_COMMIT_EVERY=10
ADULT_SYNC_TXT_COPY_ENABLED=1
ADULT_SYNC_TXT_MERGE_CHUNK_SIZE=50000
ADULT_SYNC_DB_RETRY_MAX_ATTEMPTS=4
ADULT_SYNC_DB_RETRY_BASE_SLEEP_MS=100
ADULT_SYNC_SOURCES_DIR=/app/data/artifacts/adult_sources
ADULT_SYNC_BUCKETS_DIR=/app/data/artifacts/adult_buckets
ADULT_SYNC_SOURCE_MANIFEST_PATH=/app/data/artifacts/adult_sources/manifest.json
REMNAWAVE_LOGS_SUMMARY_DAYS=7
REMNAWAVE_INGEST_COPY_ENABLED=1
ADULT_MANUAL_SYNC_STREAM=stream:adult:manual:sync
ADULT_MANUAL_SYNC_GROUP=adult_manual_sync
ADULT_MANUAL_SYNC_CONSUMER=worker-sync-1
ADULT_MANUAL_TXT_STREAM=stream:adult:manual:txt
ADULT_MANUAL_TXT_GROUP=adult_manual_txt
ADULT_MANUAL_TXT_CONSUMER=worker-txtdb-1
ADULT_MANUAL_TASK_READ_COUNT=5
ADULT_MANUAL_TASK_STREAM_MAXLEN=1000

# Worker process switches (used to split background jobs by containers)
RUN_SESSION_CLEANUP_WORKER=0
RUN_ADULT_SYNC_WORKER=0
RUN_TXT_DB_WORKER=0
RUN_DB_MAINTENANCE_WORKER=0
WORKER_ROLE=


# File logging + retention
LOG_LEVEL=INFO
LOG_DIR=/app/data/logs
LOG_FILE_NAME=nanored-api.log
LOG_ERROR_FILE_NAME=nanored-api-error.log
LOG_FILE_ROTATION_WHEN=midnight
LOG_FILE_ROTATION_INTERVAL=1
LOG_FILE_RETENTION_DAYS=7

# Global function-call logging
FUNCTION_CALL_LOGGING_ENABLED=0
FUNCTION_CALL_LOG_EXCLUDE_MODULES=app.core.logging_setup
