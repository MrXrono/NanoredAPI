<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NanoredVPN Admin</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>

<!-- LOGIN -->
<div id="login-page" class="login-container" style="display:none;">
    <div class="login-box">
        <h1>NanoredVPN</h1>
        <form id="login-form">
            <input type="text" id="username" placeholder="Логин" required autocomplete="username">
            <input type="password" id="password" placeholder="Пароль" required autocomplete="current-password">
            <button type="submit">Войти</button>
        </form>
        <div id="login-error" class="login-error"></div>
    </div>
</div>

<!-- APP -->
<div id="app" style="display:none;">
    <nav class="sidebar">
        <div class="logo">NanoredVPN <span style="font-size:11px;color:var(--text-secondary);">v1.4.2</span></div>
        <a href="#" class="nav-link active" data-section="dashboard">Панель</a>
        <a href="#" class="nav-link" data-section="devices">Устройства</a>
        <a href="#" class="nav-link" data-section="sessions">Сессии</a>
        <a href="#" class="nav-link" data-section="sni">SNI</a>
        <a href="#" class="nav-link" data-section="dns">DNS</a>
        <a href="#" class="nav-link" data-section="apps">Трафик прил.</a>
        <a href="#" class="nav-link" data-section="connections">Подключения</a>
        <a href="#" class="nav-link" data-section="errors">Ошибки</a>
        <a href="#" class="nav-link" data-section="device-logs">Логи устройств</a>
        <a href="#" class="nav-link" data-section="journal">Журнал</a>
        <a href="#" class="logout" onclick="logout()">Выйти</a>
    </nav>

    <div class="main">

        <!-- DASHBOARD -->
        <div id="section-dashboard" class="section active">
            <h2>Панель управления</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="label">Онлайн</div>
                    <div class="value green" id="online-count">0</div>
                </div>
                <div class="stat-card">
                    <div class="label">Всего устройств</div>
                    <div class="value blue" id="total-devices">0</div>
                </div>
                <div class="stat-card">
                    <div class="label">Сессии сегодня</div>
                    <div class="value" id="today-sessions">0</div>
                </div>
                <div class="stat-card">
                    <div class="label">Загрузка сегодня</div>
                    <div class="value blue" id="today-download">0 B</div>
                </div>
                <div class="stat-card">
                    <div class="label">Отдача сегодня</div>
                    <div class="value yellow" id="today-upload">0 B</div>
                </div>
                <div class="stat-card">
                    <div class="label">Общий трафик</div>
                    <div class="value" id="total-traffic">0 B</div>
                </div>
            </div>

            <div class="chart-container">
                <h3 style="margin-bottom:12px;">Сессии (7 дней)</h3>
                <canvas id="sessions-chart"></canvas>
            </div>

            <div class="dashboard-columns">
                <div class="table-container" style="padding:20px;">
                    <h3 style="margin-bottom:12px;">Топ SNI доменов (сегодня)</h3>
                    <ul class="top-list" id="top-sni-list">
                        <li>Загрузка...</li>
                    </ul>
                    <div class="pagination" id="top-sni-pagination"></div>
                </div>
                <div class="table-container" style="padding:20px;">
                    <h3 style="margin-bottom:12px;">Аккаунты</h3>
                    <table class="account-stats-table">
                        <thead>
                            <tr>
                                <th>Аккаунт</th>
                                <th>Загр. сегодня</th>
                                <th>Загр. всего</th>
                                <th>Отд. сегодня</th>
                                <th>Отд. всего</th>
                            </tr>
                        </thead>
                        <tbody id="account-stats-tbody">
                            <tr><td colspan="5">Загрузка...</td></tr>
                        </tbody>
                    </table>
                    <div class="pagination" id="account-stats-pagination"></div>
                </div>
            </div>
        </div>

        <!-- DEVICES -->
        <div id="section-devices" class="section">
            <h2>Устройства</h2>
            <div class="table-container">
                <div class="table-header">
                    <h3>Все устройства</h3>
                    <div class="table-filters">
                        <select id="device-account-filter" onchange="loadDevices(1)">
                            <option value="">Все аккаунты</option>
                        </select>
                        <input type="text" id="device-search" placeholder="Поиск..." onkeyup="loadDevices(1)">
                    </div>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Аккаунт</th><th>Android ID</th><th>Устройство</th><th>Android</th><th>Версия</th>
                            <th>Оператор</th><th>Статус</th><th>Посл. активность</th><th>Действия</th>
                        </tr>
                    </thead>
                    <tbody id="devices-tbody"></tbody>
                </table>
                <div class="pagination" id="devices-pagination"></div>
            </div>
        </div>

        <!-- DEVICE DETAIL MODAL -->
        <div id="device-detail-modal" class="modal-overlay" style="display:none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Детали устройства</h3>
                    <button class="btn btn-sm btn-danger" onclick="closeDeviceDetail()">&times;</button>
                </div>
                <div id="device-detail-body"></div>
            </div>
        </div>

        <!-- DEVICE CHANGES MODAL -->
        <div id="device-changes-modal" class="modal-overlay" style="display:none;">
            <div class="modal-content" style="max-width:750px;">
                <div class="modal-header">
                    <h3>Изменения устройства</h3>
                    <button class="btn btn-sm btn-danger" onclick="closeDeviceChanges()">&times;</button>
                </div>
                <table>
                    <thead>
                        <tr><th>Поле</th><th>Старое значение</th><th>Новое значение</th><th>Дата</th></tr>
                    </thead>
                    <tbody id="device-changes-tbody"></tbody>
                </table>
                <div class="pagination" id="device-changes-pagination"></div>
            </div>
        </div>

        <!-- SESSIONS -->
        <div id="section-sessions" class="section">
            <h2>Сессии</h2>
            <div class="table-container">
                <div class="table-header">
                    <h3>История подключений</h3>
                    <div class="table-filters">
                        <select id="session-account-filter" onchange="loadSessions(1)">
                            <option value="">Все аккаунты</option>
                        </select>
                        <input type="text" id="session-device-filter" placeholder="ID устройства..." onkeyup="loadSessions(1)">
                    </div>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Устройство</th><th>Протокол</th><th>Сервер</th><th>IP клиента</th>
                            <th>Локация</th><th>Сеть</th><th>Загрузка</th><th>Отдача</th>
                            <th>Длительность</th><th>Подключение</th>
                        </tr>
                    </thead>
                    <tbody id="sessions-tbody"></tbody>
                </table>
                <div class="pagination" id="sessions-pagination"></div>
            </div>
        </div>

        <!-- SNI -->
        <div id="section-sni" class="section">
            <h2>SNI логи</h2>
            <div class="table-container">
                <div class="table-header">
                    <h3>TLS Server Name Indication</h3>
                    <div class="table-filters">
                        <select id="sni-account-filter" onchange="loadSNI(1)">
                            <option value="">Все аккаунты</option>
                        </select>
                        <input type="text" id="sni-search" placeholder="Поиск домена..." onkeyup="loadSNI(1)">
                        <button class="btn btn-primary btn-sm" onclick="exportSNI()">Экспорт CSV</button>
                    </div>
                </div>
                <table>
                    <thead>
                        <tr><th>Домен</th><th>Запросы</th><th>Байты</th><th>Устройство</th><th>Посл. время</th></tr>
                    </thead>
                    <tbody id="sni-tbody"></tbody>
                </table>
                <div class="pagination" id="sni-pagination"></div>
            </div>
        </div>

        <!-- DNS -->
        <div id="section-dns" class="section">
            <h2>DNS логи</h2>
            <div class="table-container">
                <div class="table-header">
                    <h3>DNS запросы</h3>
                    <div class="table-filters">
                        <select id="dns-account-filter" onchange="loadDNS(1)">
                            <option value="">Все аккаунты</option>
                        </select>
                        <input type="text" id="dns-search" placeholder="Поиск домена..." onkeyup="loadDNS(1)">
                    </div>
                </div>
                <table>
                    <thead>
                        <tr><th>Домен</th><th>IP</th><th>Тип</th><th>Запросы</th><th>Устройство</th><th>Время</th></tr>
                    </thead>
                    <tbody id="dns-tbody"></tbody>
                </table>
                <div class="pagination" id="dns-pagination"></div>
            </div>
        </div>

        <!-- APP TRAFFIC -->
        <div id="section-apps" class="section">
            <h2>Трафик приложений</h2>
            <div class="table-container">
                <div class="table-header">
                    <h3>Трафик по приложениям</h3>
                    <div class="table-filters">
                        <select id="apps-account-filter" onchange="loadApps(1)">
                            <option value="">Все аккаунты</option>
                        </select>
                    </div>
                </div>
                <table>
                    <thead>
                        <tr><th>Пакет</th><th>Приложение</th><th>Загрузка</th><th>Отдача</th><th>Устройство</th><th>Время</th></tr>
                    </thead>
                    <tbody id="apps-tbody"></tbody>
                </table>
                <div class="pagination" id="apps-pagination"></div>
            </div>
        </div>

        <!-- CONNECTIONS -->
        <div id="section-connections" class="section">
            <h2>Подключения</h2>
            <div class="table-container">
                <div class="table-header">
                    <h3>IP подключения</h3>
                    <div class="table-filters">
                        <select id="conn-account-filter" onchange="loadConnections(1)">
                            <option value="">Все аккаунты</option>
                        </select>
                        <input type="text" id="conn-search" placeholder="Поиск IP..." onkeyup="loadConnections(1)">
                    </div>
                </div>
                <table>
                    <thead>
                        <tr><th>IP назначения</th><th>Порт</th><th>Протокол</th><th>Домен</th><th>Устройство</th><th>Время</th></tr>
                    </thead>
                    <tbody id="connections-tbody"></tbody>
                </table>
                <div class="pagination" id="connections-pagination"></div>
            </div>
        </div>

        <!-- ERRORS -->
        <div id="section-errors" class="section">
            <h2>Ошибки</h2>
            <div class="table-container">
                <div class="table-header">
                    <h3>Отчеты об ошибках</h3>
                    <div class="table-filters">
                        <select id="errors-account-filter" onchange="loadErrors(1)">
                            <option value="">Все аккаунты</option>
                        </select>
                    </div>
                </div>
                <table>
                    <thead>
                        <tr><th>Тип</th><th>Сообщение</th><th>Версия</th><th>Устройство</th><th>Время</th></tr>
                    </thead>
                    <tbody id="errors-tbody"></tbody>
                </table>
                <div class="pagination" id="errors-pagination"></div>
            </div>
        </div>

        <!-- DEVICE LOGS -->
        <div id="section-device-logs" class="section">
            <h2>Логи устройств</h2>
            <div class="table-container">
                <div class="table-header">
                    <h3>Загруженные логи</h3>
                    <div class="table-filters">
                        <button class="btn btn-danger btn-sm" onclick="clearAllDeviceLogs()">Очистить все</button>
                        <select id="devlogs-account-filter" onchange="loadDeviceLogs(1)">
                            <option value="">Все аккаунты</option>
                        </select>
                        <select id="devlogs-type-filter" onchange="loadDeviceLogs(1)">
                            <option value="">Все типы</option>
                            <option value="logcat">Приложение</option>
                            <option value="full_log">Полный журнал</option>
                            <option value="xray_access">Xray access</option>
                            <option value="xray_error">Xray error</option>
                            <option value="crash">Crash</option>
                        </select>
                    </div>
                </div>
                <table>
                    <thead>
                        <tr><th>Устройство</th><th>Тип</th><th>Размер</th><th>Время</th><th>Действия</th></tr>
                    </thead>
                    <tbody id="devlogs-tbody"></tbody>
                </table>
                <div class="pagination" id="devlogs-pagination"></div>
            </div>
        </div>

        <!-- DEVICE LOG VIEW MODAL -->
        <div id="devlog-modal" class="modal-overlay" style="display:none;">
            <div class="modal-content" style="max-width:900px;">
                <div class="modal-header">
                    <h3>Просмотр лога</h3>
                    <div>
                        <button class="btn btn-sm" onclick="copyDevLogContent()">Скопировать всё</button>
                        <button class="btn btn-sm btn-primary" id="devlog-download-btn">Скачать</button>
                        <button class="btn btn-sm btn-success" id="devlog-upload-btn">Загрузить на сервер</button>
                        <button class="btn btn-sm btn-danger" onclick="closeDevLogModal()">&times;</button>
                    </div>
                </div>
                <pre id="devlog-content" style="background:#0a0a14;padding:16px;border-radius:8px;max-height:60vh;overflow:auto;font-size:12px;line-height:1.5;white-space:pre-wrap;word-break:break-all;"></pre>
            </div>
        </div>

        <!-- JOURNAL -->
        <div id="section-journal" class="section">
            <h2>Журнал</h2>
            <div class="journal-controls">
                <button class="btn btn-success" id="btn-log-start" onclick="startLogs()">Старт</button>
                <button class="btn btn-danger" id="btn-log-stop" onclick="stopLogs()" disabled>Стоп</button>
                <button class="btn btn-primary" onclick="clearLogs()">Очистить</button>
                <select id="log-type-filter" onchange="refreshLogs()">
                    <option value="all">Все типы</option>
                    <option value="telemetry">Данные VPN</option>
                    <option value="request">Запросы</option>
                    <option value="processing">Обработка</option>
                    <option value="error">Ошибки</option>
                </select>
                <span class="journal-status" id="journal-status">Остановлен</span>
            </div>
            <div class="journal-terminal" id="journal-terminal">
                <div class="journal-empty">Нажмите "Старт" для начала записи журнала</div>
            </div>
        </div>

    </div>
</div>

<script src="/static/js/app.js"></script>
</body>
</html>
